<!doctype html>
<html class="no-js" lang="zxx">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="keywords" content="Site keywords here">
        <meta name="description" content="">
        <meta name='copyright' content=''>
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        
        <title>Book Appointment - Nabad</title>
        
        <!-- Favicon -->
        <link rel="icon" href="img/favicon.png">
        
        <!-- Google Fonts -->
        <link href="https://fonts.googleapis.com/css?family=Poppins:200i,300,300i,400,400i,500,500i,600,600i,700,700i,800,800i,900,900i&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
        
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <!-- Nice Select CSS -->
        <link rel="stylesheet" href="css/nice-select.css">
        <!-- Font Awesome CSS -->
        <link rel="stylesheet" href="css/font-awesome.min.css">
        <!-- icofont CSS -->
        <link rel="stylesheet" href="css/icofont.css">
        <!-- Slicknav -->
        <link rel="stylesheet" href="css/slicknav.min.css">
        <!-- Owl Carousel CSS -->
        <link rel="stylesheet" href="css/owl-carousel.css">
        <!-- Datepicker CSS -->
        <link rel="stylesheet" href="css/datepicker.css">
        <!-- Animate CSS -->
        <link rel="stylesheet" href="css/animate.min.css">
        <!-- Magnific Popup CSS -->
        <link rel="stylesheet" href="css/magnific-popup.css">
        <!-- FullCalendar CSS -->
        <link href="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.css" rel="stylesheet" />
        
        <!-- Medipro CSS -->
        <link rel="stylesheet" href="css/normalize.css">
        <link rel="stylesheet" href="style.css">
        <link rel="stylesheet" href="css/responsive.css">
        
        <!-- Appointment-specific CSS -->
        <link rel="stylesheet" href="css/appointments/appointment-styles.css">
        <link rel="stylesheet" href="css/appointments/insurance-styles.css">
    </head>
    <body>
        <!-- Preloader -->
        <div class="preloader">
            <div class="loader">
                <div class="loader-outter"></div>
                <div class="loader-inner"></div>
                <div class="indicator"> 
                    <svg width="16px" height="12px">
                        <polyline id="back" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                        <polyline id="front" points="1 6 4 6 6 11 10 1 12 6 15 6"></polyline>
                    </svg>
                </div>
            </div>
        </div>
        
        <!-- Header -->
        <header class="header">
            <div class="header-inner">
                <div class="container">
                    <div class="inner">
                        <div class="row">
                            <div class="col-lg-3 col-md-3 col-12">
                                <!-- Logo -->
                                <div class="logo">
                                    <a href="index.html"><img src="img/nabad.png" alt="#"></a>
                                </div>
                                <!-- Mobile Nav -->
                                <div class="mobile-nav"></div>
                            </div>
                            <div class="col-lg-9 col-md-9 col-12">
                        
                                <div class="main-menu">
                                    <nav class="navigation">
                                        <ul class="nav menu">
                                            <li><a href="doctors.html">Doctors</a></li>
                                            <li><a href="#" id="dashboardLink">Dashboard</a></li>
                                            <li><a href="appointments.html">Book Appointment</a></li>
                                            
                                            <li class="reminder-icon">
                                                <a href="reminder-preferences.html">
                                                    <i class="fa fa-bell"></i>
                                                    <span class="reminder-tooltip"></span>
                                                </a>
                                            </li>
                                            <li><a href="login.html" class="logout-btn" onclick="handleLogout()">
                                                <i class="fas fa-door-open"></i> 
                                            </a></li>
                                            <li class="nav-item user-greeting">
                                                <span id="userGreeting"></span>
                                            </li>
                                        </ul>
                                    </nav>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </header>
        
        <!-- Breadcrumbs -->
        <div class="breadcrumbs overlay">
            <div class="container">
                <div class="bread-inner">
                    <div class="row">
                        <div class="col-12">
                            <h2>Book Your Appointment</h2>
                            <ul class="bread-list">
                                <li><a href="index.html">Home</a></li>
                                <li><i class="icofont-simple-right"></i></li>
                                <li class="active">Book Appointment</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Appointment Section -->
        <section class="appointment single-page">
            <div class="container">
                <div class="row">
                    <div class="col-lg-12">
                        <div class="section-title">
                            <h2>Schedule Your Visit</h2>
                            <img src="img/section-img.png" alt="#">
                            <p>Choose your preferred date, doctor and time for your appointment</p>
                        </div>
                    </div>
                </div>
                
                <!-- Error container for displaying API and validation errors -->
                <div id="errorContainer"></div>
                
                <div class="row">
                    <div class="col-lg-8 col-md-12 col-12">
                        <div class="appointment-form" id="appointmentFormContainer">
                            <div class="form-section">
                                <h4>1. Select Doctor</h4>
                                <div class="row mt-3">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="doctorInput">Select Doctor</label>
                                            <div class="doctor-search-container">
                                                <input type="text" id="doctorInput" class="form-control" placeholder="Type doctor name or select from list">
                                                <div id="doctorSuggestions" class="doctor-search-results"></div>
                                            </div>
                                            <div id="doctorInfo" class="mt-2 doctor-info hidden">
                                                <span class="doctor-name"></span>
                                                <span class="doctor-specialty"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4>2. Select Time</h4>
                                <!-- Doctor Calendar Section -->
                                <div id="calendarContainer" class="hidden">
                                    <div class="view-description-container">
                                        <div id="viewDescription" class="view-description">
                                            Day view: Pick an available slot from the calendar or time slot list below.
                                        </div>
                                    </div>
                                    <div class="availability-legend">
                                        <div class="legend-item">
                                            <div class="availability-indicator available-indicator"></div>
                                            <span>Available</span>
                                        </div>
                                        <div class="legend-item">
                                            <div class="availability-indicator booked-indicator"></div>
                                            <span>Booked</span>
                                        </div>
                                    </div>
                                    <div class="card calendar-card mb-4">
                                        <div id="calendar"></div>
                                    </div>
                                </div>
                                <div id="timeSlotContainer" class="hidden">
                                    <div class="time-slots" id="timeSlots">
                                        <p>Please select a date and doctor first.</p>
                                    </div>
                                </div>
                            </div>

                            <div class="form-section">
                                <h4>3. Add Details</h4>
                                <div class="row">
                                    <div class="col-md-12">
                                        <div class="form-group">
                                            <label for="appointmentType">Appointment Type</label>
                                            <select class="form-control" id="appointmentType">
                                                <option value="REGULAR">Regular</option>
                                                <option value="RECURRING">Recurring</option>
                                                <option value="EMERGENCY">Emergency</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="col-12">
                                        <div class="form-group">
                                            <label for="appointmentNotes">Notes (optional)</label>
                                            <textarea id="appointmentNotes" class="form-control" rows="3" 
                                                placeholder="Add any special requirements or information for the doctor"></textarea>
                                        </div>
                                        
                                        <!-- Insurance Information -->
                                        <div id="insuranceInfoContainer" class="mt-3 p-3" style="display: none;">
                                            <h5>Insurance Information</h5>
                                            <div id="insuranceDetails">
                                                <p>Insurance information will be displayed here when you select a doctor.</p>
                                            </div>
                                        </div>
                                        
                                        <!-- Recurring Appointment Options -->
                                        <div class="options-section">
                                            <div class="form-group">
                                                <label>
                                                    <input type="checkbox" id="recurring"> Make this a recurring appointment
                                                </label>
                                            </div>
                                            <div id="recurringOptions" class="hidden">
                                                <div class="row">
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label for="recurrencePattern">Recurrence Pattern</label>
                                                            <select class="form-control" name="recurrence_pattern" id="recurrencePattern">
                                                                <option value="WEEKLY">Weekly</option>
                                                                <option value="BIWEEKLY">Bi-weekly</option>
                                                                <option value="MONTHLY">Monthly</option>
                                                            </select>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-6">
                                                        <div class="form-group">
                                                            <label for="sessions">Number of sessions</label>
                                                            <input type="number" class="form-control" name="sessions" id="sessions" min="2" max="12" value="4">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="form-section">
                                <h4>4. Reminder Preferences</h4>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="smsToCaregiverReminder"> Send SMS to Caregiver
                                            </label>
                                            <input type="tel" class="form-control" id="caregiverPhone" placeholder="Caregiver's Phone Number">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="emailToCaregiverReminder"> Send Email to Caregiver
                                            </label>
                                            <input type="email" class="form-control" id="caregiverEmail" placeholder="Caregiver's Email">
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Appointment Summary -->
                            <div class="appointment-summary">
                                <h4>Appointment Summary</h4>
                                <div class="summary-item">
                                    <span>Date:</span>
                                    <strong id="summaryDate">Not selected</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Time:</span>
                                    <strong id="summaryTime">Not selected</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Doctor:</span>
                                    <strong id="summaryDoctor">Not selected</strong>
                                </div>
                                <div class="summary-item">
                                    <span>Department:</span>
                                    <strong id="summaryDepartment">Not selected</strong>
                                </div>
                                <div class="summary-item" id="summaryRecurringContainer" style="display:none;">
                                    <span>Recurring:</span>
                                    <strong id="summaryRecurring">No</strong>
                                </div>
                            </div>
                            
                            <div class="text-center mt-4">
                                <button type="button" class="btn" id="confirmBtn">Confirm Appointment</button>
                            </div>
                        </div>
                        
                        <!-- Success message will be shown here after booking -->
                        <div id="appointmentSuccess" class="appointment-success" style="display:none;">
                            <i class="fas fa-check-circle"></i>
                            <h3>Appointment Booked Successfully!</h3>
                            <p id="successDetails"></p>
                            <button class="btn" id="newAppointmentBtn">Book Another Appointment</button>
                        </div>
                    </div>
                    
                    <!-- Sidebar -->
                    <div class="col-lg-4 col-md-12 col-12">
                        <div class="appointment-image">
                            <img src="img/contact-img.png" alt="#">
                        </div>
                    
                        <div class="work-hour">
                            <h3>Working Hours</h3>
                            <ul class="time-sidual">
                                <li class="day">Monday - Friday <span>8.00-17:00</span></li>
                                
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Footer -->
        <footer id="footer" class="footer">
            <div class="footer-top">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-3 col-md-6 col-12">
                            <div class="single-footer">
                                <h2>About Us</h2>
                                <p>Lorem ipsum dolor sit am consectetur adipisicing elit do eiusmod tempor incididunt ut labore dolore magna.</p>
                            
                                <ul class="social">
                                    <li><a href="#"><i class="icofont-facebook"></i></a></li>
                                    <li><a href="#"><i class="icofont-google-plus"></i></a></li>
                                    <li><a href="#"><i class="icofont-twitter"></i></a></li>
                                    <li><a href="#"><i class="icofont-vimeo"></i></a></li>
                                    <li><a href="#"><i class="icofont-pinterest"></i></a></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-12">
                            <div class="single-footer f-link">
                                <h2>Quick Links</h2>
                                <div class="row">
                                    <div class="col-lg-6 col-md-6 col-12">
                                        <ul>
                                            <li><a href="index.html"><i class="fa fa-caret-right" aria-hidden="true"></i>Home</a></li>
                                            <li><a href="doctors.html"><i class="fa fa-caret-right" aria-hidden="true"></i>Doctors</a></li>
                                            <li><a href="#" id="dashboardLink">Dashboard</a></li>
                                            <li><a href="contact.html"><i class="fa fa-caret-right" aria-hidden="true"></i>Contact Us</a></li>    
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-12">
                            <div class="single-footer">
                                <h2>Open Hours</h2>
                                <ul class="time-sidual">
                                    <li class="day">Monday - Friday <span>8.00-20.00</span></li>
                                    <li class="day">Saturday <span>9.00-18.30</span></li>
                                    <li class="day">Sunday <span>9.00-15.00</span></li>
                                </ul>
                            </div>
                        </div>
                        <div class="col-lg-3 col-md-6 col-12">
                            <div class="single-footer">
                                <h2>Newsletter</h2>
                                <p>Subscribe to our newsletter to get all our news in your inbox.</p>
                                <form action="mail/mail.php" method="get" target="_blank" class="newsletter-inner">
                                    <input name="email" placeholder="Email Address" class="common-input" type="email">
                                    <button class="button"><i class="icofont icofont-paper-plane"></i></button>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="copyright">
                <div class="container">
                    <div class="row">
                        <div class="col-lg-12 col-md-12 col-12">
                            <div class="copyright-content">
                                <p>© Copyright 2024 | All Rights Reserved</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        
        <!-- Core JS Files -->
        <script src="js/jquery.min.js"></script>
        <script src="js/jquery-migrate-3.0.0.js"></script>
        <script src="js/jquery-ui.min.js"></script>
        <script src="js/easing.js"></script>
        <script src="js/colors.js"></script>
        <script src="js/popper.min.js"></script>
        <script src="js/bootstrap-datepicker.js"></script>
        <script src="js/jquery.nav.js"></script>
        <script src="js/slicknav.min.js"></script>
        <script src="js/jquery.scrollUp.min.js"></script>
        <script src="js/niceselect.js"></script>
        <script src="js/tilt.jquery.min.js"></script>
        <script src="js/owl-carousel.js"></script>
        <script src="js/jquery.counterup.min.js"></script>
        <script src="js/steller.js"></script>
        <script src="js/wow.min.js"></script>
        <script src="js/jquery.magnific-popup.min.js"></script>
        <script src="js/bootstrap.min.js"></script>
        
        <!-- FullCalendar Script -->
        <script src="https://cdn.jsdelivr.net/npm/fullcalendar@5.11.3/main.min.js"></script>
        
        <!-- Custom JS -->
        <script src="js/main.js"></script>
        <script src="js/auth.js"></script>
        <script src="js/auth-api.js"></script>
        
        <!-- Appointment-specific JS - now using single unified file -->
        <script src="js/appointments/appointments.js"></script>
    </body>
</html>
<script>
    // Handle dashboard link and user greeting
    document.addEventListener('DOMContentLoaded', function() {
        const userGreetingElement = document.getElementById('userGreeting');
        const dashboardLink = document.getElementById('dashboardLink');
        const logoutBtn = document.getElementById('logoutBtn');
        
        // Check if user is logged in
        const token = localStorage.getItem('token');
        if (!token) {
            // User is not logged in
            userGreetingElement.innerHTML = `<i class="fas fa-user-circle"></i> Hi, Guest!`;
            dashboardLink.href = 'login.html';
            return;
        }
        
        // User is logged in, try to get their profile
        try {
            // Parse the user data from localStorage
            const userData = JSON.parse(localStorage.getItem('user') || '{}');
            
            // Update greeting with user's name
            let displayName = userData.first_name || userData.email?.split('@')[0] || 'User';
            userGreetingElement.innerHTML = `<i class="fas fa-user-circle"></i> Hi, ${displayName}!`;
            
            // Set dashboard link based on user role
            if (userData.role) {
                if (userData.role.toLowerCase() === 'doctor') {
                    dashboardLink.href = './Doctor Dashboard/doctor-dashboard.html';
                } else {
                    dashboardLink.href = './Patient Dashboard/patient_dashboard.html';
                }
            } else {
                // Default to patient dashboard if role is not defined
                dashboardLink.href = './Patient Dashboard/patient_dashboard.html';
            }
            
            console.log('User data loaded:', userData);
        } catch (error) {
            console.error('Error loading user data:', error);
            // Even if there's an error parsing the data, don't redirect to login
            // since we've confirmed there is a token
            dashboardLink.href = './Patient Dashboard/patient_dashboard.html';
        }
        
        // Add logout functionality
        if (logoutBtn) {
            logoutBtn.addEventListener('click', function(e) {
                e.preventDefault();
                // Clear all authentication data
                localStorage.removeItem('token');
                localStorage.removeItem('user');
                
                // Redirect to login page
                window.location.href = 'login.html';
            });
        }
    });
</script>